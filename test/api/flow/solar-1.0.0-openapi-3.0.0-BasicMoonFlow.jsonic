# BasicMoonFlow

main: sdk: flow: BasicMoonFlow:
{
  name: "BasicMoonFlow",
  active: true,
  param: {
    SOLAR_TEST_MOON_ENTID: {
      moon01: "MOON01",
      moon02: "MOON02",
      moon03: "MOON03"
    }

    SOLAR_TEST_LIVE: "FALSE",
    SOLAR_TEST_EXPLAIN: "FALSE",
    SOLAR_TEST_PLANET_ENTID: {
      planet01: "PLANET01"
    }
  }

  test: {
    entity: {
      moon: {
        MOON01: {
          id: "MOON01",
          name: "s1",
          planet_id: "PLANET01",
          kind: "s3",
          diameter: 4
        }

        MOON02: {
          id: "MOON02",
          name: "s33",
          planet_id: "s34",
          kind: "s35",
          diameter: 54
        }

        MOON03: {
          id: "MOON03",
          name: "s65",
          planet_id: "s66",
          kind: "s67",
          diameter: 104
        }
      }
    }
  }

  step: [
    {
      name: "load_moon0",
      kind: "entity",
      entity: "moon",
      action: "load",
      match: {
        id: "`dm$=p.SOLAR_TEST_MOON_ENTID.moon01`",
        planet_id: "`dm$=p.SOLAR_TEST_PLANET_ENTID.planet01`"
      }

      valid: {
        "`$OPEN`": true,
        id: "`dm$=s.load_moon0.match.id`",
        planet_id: "`dm$=p.SOLAR_TEST_PLANET_ENTID.planet01`"
      }
    }

    {
      name: "update_moon1",
      ref: "load_moon0",
      action: "update",
      reqdata: {
        name: "s1-`$WHEN`"
      }

      valid: {
        "`$OPEN`": true,
        id: "`dm$=s.load_moon0.match.id`",
        planet_id: "`dm$=p.SOLAR_TEST_PLANET_ENTID.planet01`",
        name: "`dm$=s.update_moon1.reqdata.name`"
      }
    }

    {
      name: "load_moon2",
      kind: "entity",
      entity: "moon",
      action: "load",
      match: {
        id: "`dm$=p.SOLAR_TEST_MOON_ENTID.moon01`",
        planet_id: "`dm$=p.SOLAR_TEST_PLANET_ENTID.planet01`"
      }

      valid: {
        "`$OPEN`": true,
        id: "`dm$=s.load_moon0.match.id`",
        planet_id: "`dm$=p.SOLAR_TEST_PLANET_ENTID.planet01`",
        name: "`dm$=s.update_moon1.reqdata.name`"
      }
    }
  ]
}